---
layout: post
title: "从气缸驱动到光耦输入电路的设计"
author: 科长
mail: kezhang@rcstech.org
description: "简要分析了气缸驱动和光耦输入级电路"
category: 经验总结
tags: 
    - 电路
---
{% include JB/setup %}

　　刚加入电路组时正式做的第一块板是气缸驱动，当时的驱动方式是：“光耦→三极管→MOS管→电磁阀”，体积比较大；考虑到今年要用到较多的气缸，于是想到简化电路以缩小板的体积，于是就有了“光耦→三极管→电磁阀”的想法。本着能减一个元件是一个元件的原则，以及电磁阀的工作电流并不是非常大，于是就有了这么一个版本：

<!--more-->

![不能用的气缸驱动设计]({{site.img_path}}/2012-12-08 cylinder_1.png)

　　经测试，嗯...发现是不能用的...= =！于是又有了这么一个版本：

<div style="text-align:center"><img src="{{site.img_path}}/2012-12-08 cylinder_2.png" style="width:236px" alt="达林顿结构">
</div>
<!--![达林顿结构]({{site.img_path}}/2012-12-08 cylinder_2.png)-->

　　测试后发现光耦漏电流会影响工作，现象是：①上电之后，某些路指示灯会亮。②用手指接触光耦副边的两个管脚，导致指示灯亮。

　　原因分析：因为此时的工作电压较大（24V/12V），于是光耦的截止漏电流比较大，经过8050放大后，可能使指示灯发亮；用手指接触电路后，相当于在光耦副边并联一个大电阻，使得8050的基极电流增大，因此指示灯亮。

　　解决方案：在8050的be结并联一个电阻（1k），测试通过。

　　到此，回过头来想想，当初选用达林顿结构是为了减少元件数量，但是经过两次改动之后，元件数量并没有比原来的设计少很多，仅仅是少了MOSFET这一级。考虑到光耦漏电流的存在，以及元件数量，决定还是采用如下结构：


<div style="text-align:center"><img src="{{site.img_path}}/2012-12-08 cylinder_3.png" style="width:451px" alt="集电极负载型驱动">
</div>

<!--![集电极负载型驱动]({{site.img_path}}/2012-12-08 cylinder_3.png)-->

参数计算：

　　24V情况下：继电器工作电流为20-30mA，按30mA算；查询手册中8050的电流放大倍数为30-100，取最小值，于是基极电流至少为1mA；那么R<sub>2</sub>不大于24k，考虑到电源和电阻的误差，不妨取10k。为了使8050成功截止，光耦副边导通的情况下，允许通过的电流应该大于1mA，若521的饱和电流传输比按30%（手册中最小值）计算，那么源边电流至少为3.3mA；若驱动电压为3.3V，LED压降为1.1V，那么限流电阻R<sub>1</sub>应不大于660欧；考虑到误差等因素，可取330欧。

　　12V情况下：计算方法与以上类似。继电器电流150mA，得到R<sub>1</sub>不大于120欧，R<sub>2</sub>不大于2.4k。

　　以上计算基于“最坏情况”，即饱和电流传输比和三极管电流放大倍数均取最小值，继电器工作电流取最大值。关于光耦LED的压降，参考TLP521手册中的表格：

<div style="text-align:center"><img src="{{site.img_path}}/2012-12-08 cylinder_4.png" style="width:398px" alt="TLP521_LED压降">
</div>

<!--![TLP521_LED压降]({{site.img_path}}/2012-12-08 cylinder_4.png)-->

　　注意到，在12V继电器工作情况下，光耦源边限流电阻的计算值是120欧，比较小；又注意到今年和去年，光耦经常损坏，经测试多为LED损坏，考虑如何为输入级加保护电路。于是查找各种资料，得到以下一些用法，罗列并逐一尝试分析。以下分析为网友观点结合个人见解，难免有误，[欢迎指正](mailto:kezhang@rcstech.org)。

用法一，电科的PWM处理模块：

![电科PWM处理模块]({{site.img_path}}/2012-12-08 cylinder_5.png)

分析：在输入端并联一个1nF的电容和肖特基二极管1N4148。参考TLP521的datasheet，得知光耦LED的反向耐压只有5V，1N4148应该是用于钳制反向电压，防止出现反向电压尖峰将LED击穿。电容一定程度上会降低信号的反转速度，但也能起到一定的滤波作用。而且在上电瞬间，因为电容两端的电压不能突变，也避免了上电误触发。

用法二，铭朗电机驱动器：

　　在光耦的输入端反向并联一个1.5V的稳压二极管。

　　分析：若把稳压二极管视作普通二极管，那么作用和用法一是类似的；但是此时多出了一个正向电压钳制的作用。

用法三，Agilent公司的某电路：

![Agilent公司电路]({{site.img_path}}/2012-12-08 cylinder_6.png)

　　分析：根据TLP521的datasheet，在1MHz的情况下，LED的结电容为30pF，此处应用的是其他光耦，但也存在结电容。在电阻R309处并联一个二极管可以加速LED的关断。

用法四，某网站帖子上的一个光耦用法：

![某帖子光耦用法]({{site.img_path}}/2012-12-08 cylinder_7.png)

　　分析：1N4148的作用已提及。外部LED起到指示灯的作用，并联的1.8k电阻是作为LED的结电容泄放通路，起到加速翻转的作用。另外，光耦输入端并联电阻可以在断电情况下作为静电泄放回路；且，在上电瞬间，若信号线处于高阻态，光耦LED状态可能受到噪声干扰，而并联电阻可以起到稳定电压的作用。

用法五，富士IPM应用中关于光耦的对比一：

![富士对比1]({{site.img_path}}/2012-12-08 cylinder_8.png)

![富士对比2]({{site.img_path}}/2012-12-08 cylinder_9.png)

　　分析：查询datasheet发现，光耦的两边是有一定的寄生电容的，主要体现在输入端LED的阴极和输出端三极管的射极之间；TLP521的寄生电容在1MHz的情况下是0.8pF。考虑到PCB线路的分布电容等，这个值可能有所增大。为了降低两边的噪声耦合，就要尽量降低源边LED阴极的$d_u/d_t$。以上两个图的区别正在于此。

应用六，富士IPM应用中关于光耦的对比二：

![富士对比3]({{site.img_path}}/2012-12-08 cylinder_10.png)

![富士对比4]({{site.img_path}}/2012-12-08 cylinder_11.png)

　　分析：同样考虑寄生电容和分布电容，良例降低了限流电阻的$d_i/d_t$，从而降低了源边LED阴极的$d_u/d_t$。以上关于寄生电容的讨论，仅在高速应用下需要考虑，普通应用下影响很小。

　　综合以上考虑，将气缸驱动改为这样：

![气缸驱动伪最终版]({{site.img_path}}/2012-12-08 cylinder_12.png)

　　其中，1N4007用于抬升8050的导通电压，1N4148为电磁阀的续流二极管，1N4750用于保护三极管8050。

　　再后来，发现了达林顿输出的光耦TLP-523，于是驱动改成了这样：

![气缸驱动最终版]({{site.img_path}}/2012-12-08 cylinder_13.png)
